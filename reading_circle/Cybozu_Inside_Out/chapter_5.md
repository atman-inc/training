# テスト自動化

学習者：m.sasaki

### まとめ

_テストを適切に行うために適切な段階で適切なテストを自動化する文化をチームで作っていく事が重要_

### テスト自動化を行う理由
- メリット
  - 速い
    - 人間がテストを行うよりも速い
  - 安い
    - プログラムで実行するので人的工数がかからない
  - 正確
    - うっかり、見落とし等の人的ミスがなく正確

- 開発プロセスに対する効果
  - 開発物に対する素早いフィードバックが可能
    - 問題に対処するための工数削減
      - 記憶を掘り起こす時間
      - 経緯を確認する時間
      - （他人が作った）プログラムの内容を把握する時間

#### 短期間で開発を行うアジャイル開発において素早いフィードバックを行えるのがメリット

---

### E2E テストを自動化する（E2E　＝　end to end）
- Selenium IDE　（[公式サイト](https://www.selenium.dev/selenium-ide/ "Selenium IDE")）

<br>

- ツール概要
  - ブラウザで行った操作を記録（Recode）して再現（Replay）する
  - ブラウザのプラグインとして動作する
    - FireFox / Chromeに対応
  - 記録した操作をCUIで実行可能

---

### 自動化したテストを使わなくなる理由
- 動かなくなった
  - 製品の仕様変更により動かなくなった
  - ブラウザのバージョンなどの外部変化により動かなくなった

<br>

- メンテナンスできない
  - メンテナンスできる人がいない

<br>

- 工数が確保できない
  - メンテナンス量が多すぎて手が回らない

---

#### テスト内容に変化がなくてもメンテナンスが必要
- 機能や仕様の変化
- ブラウザ・OSの変化などの外的要因

<br>

- 自動化したテストは繰り返し利用しないと効果は薄い
  - テスト自動化には多くのコストがかかる
  - 繰り返し利用することで初期コストに効果が生まれる（テストにかかるToCを下げる）

- 用語
  - ToC
    - Theory Of Constraints(制約条件の理論)
    - 作業工程の能率を向上させる手法の1つ
    - 一連の工程全体の中でボトルネックになっている箇所を探し、集中的に改善する方式

---

- テスト自動化を行う際に気をつけたいこと
  - 長期間使うことを意識する
  - 作成時のコストを下げることを考慮
  - メンテナンス性を考えて実装

<br>

---

### 作成・メンテナンスのコストが高くなる原因

- 初期実装コストが高い
  - 技術的には自動化が可能でも作成工数が高い
    - 作成工数が高くないテストだけを自動化

<br>

- 仕様変更が多い機能の自動化
  - 「枯れていない機能」
    - 変更が少ないテストだけを自動化

<br>

- 外部仕様の変更
  - OSやブラウザ・ライブラリの変化等
    - 回避不可

- まとめ
  - 以下に重点を置いて自動化を行う
    - 重要度の高い機能
    - 繰り返しテストが実行される機能
    - 自動化する難易度が低い機能

<br>

- とはいえ
  - 自動化するしないはプロジジェクトや会社によって違うと考える
  - その為、その時の状況や考え方に合わせる柔軟さも重要だと感じる

---

### テスト自体のコスト削減
- 開発工程ごとのテスト
  - 仕様を検討して、不具合の作り込みを防止
- Unitテスト（単体テスト）
  - 関数、メソッド等、最小単位のプログラムに対するテスト
- インテグレーション（結合テスト）
  - 機能に対するUIを用いないテスト
- E2Eテスト（UIテスト）
  - ユーザー操作に最も近いブラウザを用いたテスト

#### 各プロセスで必要なテストを行うことが全体の工数削減につながる
- 「テストピラミッド」の概念
  - テスト実行コストが低い層のテストを厚く行う
    - 全体のコスト削減
  - 効率のいい開発（テスト）を行う上で重要な概念

<br>

- 読んでみて感じたこと
  - Rspecについて学習し、どのような実装をするのか理解する
  - その上でどのような実装をするべきなのかしっかりと考えたい
  - 今までの会社ではそもそもE2Eテストのみしかせずにいた
  - 色々と今までの間違いに気づけて後悔する部分が多い

#### 全体を通してテストの目的の明確化、テストにかかる工数の違いを認識することが大切

---

### チームで取り組む
- テストはテスターがやる時代もあった（組織的な区別があった）

#### 品質向上はチーム全体の問題

- チームで共有を行う
  - テスト自動化の方針
    - 自動化の方法・ツール
    - 誰が、どのテストを、どのタイミングで実装するか

<br>

  - テスト自動化の工数
    - 作成・メンテナンスに必要な工数

<br>

  - テスト自動化の知識