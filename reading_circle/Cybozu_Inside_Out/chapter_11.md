# セキュリティ

学習者：m.sasaki

---

### PSIRTとは
- PSIRT　（Product Security Incident Response Team）
- 製品のセキュリティ品質向上やインシデント対応・支援などを行うチーム

---

### Webセキュリティ
- 情報セキュリティの3要素（CIA）
  - 機密性（Confidentiality）
  - 完全性（Integrity）
  - 可用性（Availability）

#### 情報セキュリティとは「CIA」を維持すること

<br>

- **情報資産**
  - 情報セキュリティで保護すべき対象
    - PC
    - 設備
    - 印刷物
    - 情報
    - 人

> **具体例**
> - 顧客の個人情報、購入履歴
> - 企業間で交わした契約書
> - 企業の人事情報
> - 社内で利用しているシステムのID、パスワード情報
> - 社内で利用しているシステムのプログラムソースコードやOS、ネットワーク機器の情報
> - 商品の仕入先や販売先情報
> - 生産計画、製品の設計図面、仕様書
> - ブランドや企業イメージといった無形資産
> - 技術ノウハウや特許情報
> - サーバーや記録メディア等の情報を記録する装置全般

<br>

- **脆弱性**
  - セキュリティ上の問題箇所
    - ソフトウェア製品の本来の機能や性能を損なう原因となりうる箇所
    - 不適切な運用により、セキュリティが維持できなくなっている状態


> **Webアプリケーションの主な脆弱性**
> - クロスサイトスクリプティング
> - SQLインジェクション
> - 強制ブラウジング
> - Cookieの濫用
> - コンテンツの脆弱性
> - バックドア及びデバッグオプション
> - パラメータの改ざん

<br>

- **驚異**
  - 組織に損害を与える可能性のある潜在的な原因
    - 外部からの攻撃
    - 自然災害
    - 人的ミス
  - 驚異が脆弱性をつくことでリスクが発生

<br>

- **共通脆弱性タイプ一覧　CWE**
  - CWE (Common Weakness Enumeration)
    - 非営利団体のMITREが中心となって策定しているソフトウェアにおけるセキュリティ上の脆弱性の識別番号
      - 例：
        - CWE-89: SQLインジェクション
        - CWE-352: CSRF

<br>

- **共通脆弱性識別子　CVE**
  - CVE (Common Vulnerabilities and Exposures)
    - 非営利団体のMITREが中心となって裁判している、個々の脆弱性を識別する番号
      - 例：
        - CVE-2014-6271: ShellShock(bash)
        - CVE-2019-0708: BlueKeep(Remote Desktop services)

---

### 脆弱性の原理と対策
- **CWE-89 SQLインジェクション**
  - SQLインジェクション
    - Webアプリケーションを通じて任意のSQL文をデータベースに対して発行できる脆弱性
  - 原理
    - 攻撃者のSQL文の構造を破壊するような入力を適切に処理せずにSQL文が発行されることで予期しないSQL文が実行

> **SQLインジェクション　原因と対策**
> *原因*
> - ユーザーが入力した文字列をエスケープしていない
> 
> *対策*
> - 静的プレースホルダやテンプレートエンジン等、フレームワークの支援機構を利用する
```markdown
- **個別調査**
  - SQLインジェクション主な種類
    - インバウンドSQLインジェクション
      - Webアプリケーションへの入力に対するレスポンスを収集し、脆弱性濃霧などを分析する攻撃手法
      - 他の種類と比べて簡単に実行できるため、被害が多い
    - エラーベースSQLインジェクション
      - Webアプリケーションに対して意図的にエラーメッセージを出力させ、その内容からデータベースの脆弱性を探る攻撃手法
    - ブラインドSQLインジェクション
      - Webサーバーへの複数のデータを送信した際のレスポンスや動作の違いからデータベースの情報を分析する攻撃手法
    - UNIONインジェクション
      - データベースにおける複数検索の結果を1つにまとめるSQL文「UNION」を悪用して情報を取得する攻撃手法
    - マルチプルステートメント
      - セミコロンなどによって複数のSQL分をまとめる、「マルチプルステートメント」機能を悪用した攻撃手法
```

<br>

- **CWE-79 クロスサイトスクリプティング（XSS）**
  - XSS
    - Webアプリケーションを通じて任意のスクリプトを利用者のブラウザで実行させる脆弱性
  - 原理
    - HTMLタグやJavascriptタグなどの構造を破壊する入力をすることでスクリプトを実行される
  - 種類
    - 蓄積型 XSS: 攻撃コードがDB等に保存されている
    - 反射型 XSS: 攻撃コードがリクエストに含まれる
    - DOM-Based XSS: DOM操作時に発生する

> **XSS　原因と対策**
> 原因
> - HTMLのエスケープ漏れ
> - 文字コードやコンテンツ型の自動判別への理解不足
> 
> 対策
> - HTMLは正しくエスケープする
> - 文字コードは必ず宣言する
> - コンテンツ型がHTMLと判定されないようにする

```markdown
- **個別調査**
    - XSSの種類
      - 反射型XSS (non-presistent/Reflected XSS)
        - 偽メール、偽サイトに不正なスクリプトを含んだリンクを用意
        - ユーザーを脆弱性のあるWebサイトに誘導
        - ユーザーのブラウザで不正なスクリプトを実行
        - 情報の詐取やマルウェア感染などを行う
      - 格納型/蓄積型/持続型XSS (Stored/Presistent XSS)
        - あらかじめWebアプリケーションに直接スクリプトを実装
        - 該当ページにアクセスしてきたユーザーに不正なスクリプトを実行
      - DOM Based XSS
        - Javascriptコードの脆弱性を悪用した攻撃
        - クライアント側（Webブラウザ上）で不正なスクリプトを実行
```

<br>

- **CWE-352 クロスサイトリクエストフォージェリ(CSRF)**
  - CSRF
    - 被害者に罠リンクをクリックさせることで意図せず処理させる脆弱性

> **CSRF 原因と対策**
> 原因
> - CSRF対策チケットが発行・検証されていない
> - X-Requested-With ヘッダが付与・検証されていない
> - CSRF対策チケットの強度が弱い
> 
> 対策
> - 十分強度のあるCSRF対策チケットの付与、検証を行う
> - X-Requested-With ヘッダの付与・検証を行う
> - 実績のあるフレームワークを使う

```markdown
- **個別調査**
  - CSRF(Cross Site Request Forgeries)・・・シーサーフと呼ばれる
  - ログイン状態のサイトに偽のリクエストが送信・実行されてしまうこと
  - CSRF Tokenなどを確認画面にhiddenパラメータとして発行し防ぐ
  - HTTPリクエストのRefererヘッダに参照元ページのURLを入れ、Refererで検証を行い防ぐ
```

<br>

- **ブラウザが提供するセキュリティ機構**
  - Same-Origin Policy (SOP)
    - スキーム、ホスト名、ポート番号※1の組が異なる場合、DOMの参照や通信の一部を禁止する
      - Originが同一・・・Same-Origin
      - Originが異なる・・・Cross-Origin
  - Content Security Policy (CSP)
    - サーバーサイドWebアプリケーションが課した制約に違反する挙動をWebブラウザが検出する
      - 指定されたJavascript以外読み込まないなど

<font color="red" size="2">※1・・・スキーム、ホスト名、ポート番号の組のことをOriginと呼ぶ</font>

- 読んでいて感じたこと
  - 今までAPI接続の際に出ていたCORSエラーをなんとなく読んでしまっていたが、今回の内容でどのようなものなのか少し理解できたと考える

<br>

- **セキュリティ機能**
  - 以下を指定することで特定のセキュリティ機能を付与できる
    - X-XSS-Protection
    - X-Content-Type-Options
    - X-Frame-Options
      - クリックジャッキングを防ぐ
    - Content-Disposition: attachment;
    - Strict-Transport-Security

<br>

- **Cookieの扱い**
  - Cookieを発行時に属性を指定することで扱いを制限できる
    - Expires: 絶対的な有効期限を指定
    - Max-Age: 相対的な有効期限を指定
    - Domain: 利用可能なホストを指定
    - Path: 利用可能なパスを指定
    - Secure: HTTPSを利用しているときのみに送信される
    - HttpOnly: jsなどからの呼び出し禁止
    - SameSite: リクエストを元に応じてクッキーをセットするかを指定

