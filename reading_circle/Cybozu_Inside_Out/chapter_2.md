# HTTPSとDNS

学習者：m.sasaki

## まとめ

_通信について深堀りを行う。普段何気なく使っている通信を理解する。_

### DNS(Domain Name System)

- IPアドレスだと人間が読みにくく覚えにくい
    - IPアドレスに人間の読みやすい名前をつける（名前解決）
    -  DNSを使用してドメイン名とIPアドレスの紐付けを行う（IPアドレス以外も）

- 名前解決の流れ
    - クライアントからキャッシュDNSサーバーに問い合わせ
    - ルートDNSに問い合わせ
    - TLD権威DNSサーバーに問い合わせ（JP,COM等）
    - 2LD権威サーバーに問い合わせ
    - IPアドレスの返却
        - キャッシュDNSサーバーが各権威サーバーに問い合わせを行う
        - 最後に返却されてきたIPアドレスをクライアントに返却

- DNSレコードの種類
    - SOA
        - Start of Authority(DNS Zoneの権威情報)
    - NS
        - Name Server(対象ドメインの権威 DNSサーバー　複数)
    - A
        - Address(IPv4)
    - AAAA
        - IPv6アドレス(IPv4の4倍のbit数)
    - CNAME
        - Canonical Name
        - ドメインのエイリアス
        - DNSレベルのリダイレクト
    - MX
        - Mail eXchanger
        - メールサーバー
        - 複数ある場合は優先度も指定可能
    - TXT
        - Text: 何でもあり
        - 定義されている特殊なTXTレコード
            - DMARC
            - DKIM
            - SPF
            - etc...
        - その他クラウドサービスを使うときのドメインの所有者確認等
    - PTR
        - Pointer
        - 逆名前解決
            - IPアドレスからドメイン名を問い合わせる
    - etc...

- Zoneファイル
    - DNSゾーンの情報が入っているテキストファイル
    - DNSレコードを使用して自身が管理しているゾーンを定義



### HTTP(Hypertext Transfer Protocol)
- 汎用的なテキストベースで通信を行うためのプロトコル
    - やり取りはテキストベースだが、送るデータは自由
    - ブラウザの裏側でHTMLを解釈してくれる

- リクエスト
    - GET
        - リソースを取得
    - POST
        - リソースを送る、処理を依頼する
    - DELETE
        - リソースを消す
    - PUT
        - リソースを更新する
    - PATCH
        - リソースを部分的に更新する
    - etc...
        - ※あくまでも仕様でサーバーによって変わる場合もあり

- Target
    - サーバーのどのリソース・エンドポイントに対しての要求なのか指定する
        - 単純ファイル
        - 動的なファイルコンテンツ
        - etc...

- Version
    - どのHTTPバージョンを利用するか指定する
        - HTTP/1.0
        - HTTP/1.1
        - HTTP/2
        - HTTP/3

- Header
    - リクエストに対する追加情報
    - Host
        - 同じIPアドレスで複数サービスを立てる際に必要
    - etc
        - USer-Agent
        - Accept-Encoding
        - Connection
    
- Body
    - 使うHTTP methodによってクライアントからデータを送る場合もある
        - POST/PUT
        - Headerの後にリクエストのBodyに入れて送信する

### HTTPレスポンス

- Status Code
    - リクエストの処理結果
    - 1xx
        - コネクションの情報
    - 2xx
        - 成功系
    - 3xx
        - リダイレクト系
    - 4xx
        - クライアント側のエラー
    - 5xx
        - サーバー側のエラー

- 追加リクエスト
    - Status Codeによってクライアントに追加処理が発生する
    - リダイレクトを行う
    - 認証情報の入力要求
    - etc...

### 動的コンテンツ

- HTTPサーバーは受け取ったHTTPリクエストに対して反応
    - HTTPレスポンスの生成
        - ファイルをそのまま返却
        - 内容を動的に生成して返却

### HTTP Secure(HTTPS)

- HTTPをTLSの上に構築
    - TLS(Transport Layer Security)
        - TCP/IPを使用したサーバーとクライアントの通信
        - セキュアなチャンネル（通信路）を利用できるようにした仕組み
        - 以前はSSLと呼ばれていたもの
    - 暗号化されるため、盗まれても解読が困難

- TLSで守りたいもの
    - 通信相手が本物であるか
        - デジタル署名
        - 本物のサーバーか
        - 本物のクライアントか
    
    - 通信内容が盗まれないこと
        - 対照暗号
        - クレジットカードの番号が漏洩しないように
    
    - 通信内容が改ざんされないこと
        - メッセージ認証コード
- SSL証明書の発行（アドレスの身分証明）
    - 公開キーと非公開キーを使用
    - 証明したいアドレスの身元情報と公開キーのCSRを発行
        - Certificate Signing Request
        - 証明書の署名リクエストのこと
    - CSRを認証局（CA）に送る
    - CAが非公開キーと身元情報を使用してCSRを承認する
        - SSL証明書
            - 証明書と非公開キーを持っているものが本物のアドレスと証明する

    - 身元確認以外にも決める必要がある項目
        - やり取りで使用する対照暗号
        - 暗号の秘密を何にするか

- 信頼されていない認証局（CA）からの証明書
    - クライアントの信頼リストに入っていなければ拒否される
    - CAは信頼が全て
    - 漏洩したら大惨事
    - インシデントが起きた際に報告義務がある
    - 信頼できないCAはブラウザの信頼リストから除外