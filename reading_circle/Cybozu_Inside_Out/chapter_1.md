# アプリケーション概要

学習者：m.sasaki

## まとめ

_Web開発の知識を広範囲に渡って紹介。この知識を使って自分で知識を広げていけるように_

## はじめに

- WEBアプリを作るのに必要な基礎知識の話
    - 雑多な知識
    - キーワードで自分で調べられる様になることが目的

### WEBアプリケーション

- WEBブラウザをインターフェースとして入出力するアプリケーション
    - 通信：HTTP
    - 表示：HTML、CSS
- アプリケーションはサーバーに設置
- ネイティブアプリやデスクトップアプリとは異なる。
    - ただし、内部でWEBアプリケーションが提供するAPIを利用しているものもある

### WEBサーバー

- HTTPを処理するサーバー
    - クライアントから問い合わせを受付（リクエスト）
    - 受付に対して結果を返す（レスポンス）

- WEBサーバソフト
    - Apache
    - IIS
    - nginx

  - 解説
    - apache
      - 特徴
        - 世界的に最も普及しているWEBサーバーソフト
        - Apacheソフトウェア財団が開発しているOSS
        - 1アクセスに対して1つの対応
          - アクセスが急増すると負荷が増大
          - 遅くなりダウンし易い
      - 難易度
        - やや難しい
      - 利用できる代表的な言語
        - PHP

    - IIS
      - 特徴
        - Microsoft社が提供しているWEBサーバーソフト
        - Windowsにもインストール可能
        - 視覚的な操作が出来て構築のハードルが低め
      - 操作方法
        - コマンド入力
      - 難易度
        - 比較的易しい
      - 利用できる代表的な言語
        - ASP.net

    - nginx
      - 特徴
        - Apacheと比べて動作が速い
        - 大量の処理が得意
        - 複数のアクセスに対して1つの対応にまとまる
          - アクセスに比例して負荷は急激には増えない
          - 処理速度を維持してダウンしにくい
      - 操作方法
        - コマンド入力
      - 難易度
        - 難しい
      - 利用できる代表的な言語
        - Node.js

#### Socket

- サーバーとクライアントで通信するためのAPI（ネットワークの接続口）
    - 主にTCP、UDPを使う
    - 同一マシン、別のマシンどちらとでも通信可能

- 処理の流れ
    - Socketの作成(socket)
    - アドレスを設定(bind)
    - リクエストを受付(listen)
    - リクエストを確立(accept)
    - 読み書きを行う（read/write）
    - 通信をクローズ（close）

- 同時に複数のリクエスト
    - プロセスやスレッドを使用

#### Socket通信とHTTP通信
- HTTP
  - サーバーサイドプログラムをWEBアプリ、WEBサービスで作れる
  - 暗号化の際に容易に乗せられる
  - Proxyが使用できる

- Socket通信
  - IPアドレスとポート番号の組み合わせで表現
  - TCP
    - Transmission Control Protocol
    - IPの上位プロトコルのトランスポート層で動作するプロトコル
    - インターネットにおいて標準的に利用されるプロトコル
    - ネットワーク層のIPとセッション層以上のプロトコルの橋渡しをする形で動作
    - 高信頼性を提供
    - UDPと比べて負荷がかかる
  - UDP
    - User Diagram Protocol
    - TCP同様トランスポート層で動作するプロトコル
    - コネクションレス型のプロトコル
    - TCPと比べると信頼性がない
    - 高速性を重視する
    - UDPヘッダサイズが少ない（8byte）為、アプリのデータを多く送受信可能
      - ただしパケットロスが容認できるアプリである必要がある

- パケットロス
  - ネットワーク上を転送されているパケットが何らかの理由で消失すること
  - データパケットが相手に到達できない場合に発生する

- TCP/IP
  - 概要
    - ネットワーク通信プロトコル群の総称
      - TCPやIPも含まれる
    - 実用性を重視したシンプルな階層構造の通信規格
    - 現在のネットワーク通信で使用されている
    - TCP/IP階層
      - 4層：アプリケーション層
      - 3層：トランスポート層
      - 2層：インターネット層
      - 1層：ネットワークインターフェース層（ハードウェア部分）

    - OSI参照モデルの階層との比較
        - 4層：7,6,5層
        - 3層：4層
        - 2層：3層
        - 1層：2,1層

#### 通信系の余談
- OSI参照モデル
  - 必要な約束事（プロトコル）を階層構造（レイヤー）に分けてモデル化したもの
  - 異なるコンピューター同士が通信を行えるようにしたもの
  - 7階層のカテゴリーに分けられる
    - 7層：アプリケーション層・・・アプリケーションソフト同士の通信に関する規格
    - 6層：プレゼンテーション層・・・文字コード、画像・映像の圧縮形式等、データの表現方法に関する規格
    - 5層：セッション層・・・データのやり取りの開始から終了までの手順に関する規格
    - 4層：トランスポート層・・・データを確実ンビ伝送する規格
    - 3層：ネットワーク層・・・データの伝送ルートなどに関する規格
    - 2層：データリンク層・・・接続されたコンピューター同士で通信するための規格
    - 1層：物理層・・・ケーブル等の実際にデータを通信するパーツの規格


### プロセスとスレッド

#### プロセス

- プログラムの実行単位
    - コマンド、アプリの起動でプロセスが立ち上がる
    - 別のプロセスのメモリにはアクセス不可
    - 異なるプロセスは並列に動作可能

- WEBサーバー
    - リクエストを受付
    - 処理プロセスを起動してソケットを引き継ぐ

#### スレッド

- 1つのプロセスの中の処理単位
    - 並列処理が可能
    - 同じプロセスの別スレッドのメモリにアクセスできる

- WEBサーバー
    - リクエストを受付
    - 処理スレッドを起動して処理

### CGI(Common Gateway Interface)

- WEBサーバーとプログラムがやり取りするためのインターフェース
    - リクエストのたびにアプリのプロセスを起動
    - リクエストの内容は環境変数や標準入力で渡される
    - 結果は標準出力
    - 昔は主流だった

### WEBアプリケーションサーバー

- WEBアプリケーションを実行するサーバー
    - CGIとは異なり、通常は常時起動
    - WEBサーバーがアプリケーションサーバーにリクエスト
    - 主にHTTP通信

- アプリケーションサーバーとアプリ
    - サーバーからアプリの特定メソッドを呼び出してやり取り

### データベース

- WEBアプリケーションではデータの保存が必須になる
    - プログラム、マシンが終了後もデータを保持したい
    - ファイルに保存して管理をすると競合や不整合の回避が大変
    - DBMS(データベース管理システム)で管理を行う

- データベース管理システム（DBMS）
    - RDBMS / SQL
        - 「関係モデル」を扱うデータベース
        - SQL言語で操作
    - メリット
      - SQLによる操作を行える
      - 複雑なデータの扱いが容易
    - デメリット
      - データの整合性を保つ代わりに処理が遅くなる
      - 仕様変更への柔軟性が低い
    - 種類
        - MySQL
        - PostgreSQL
        - SQL Server
        - Oracle Database
    
    - NoSQL
        - SQLに対抗して出現したデータベース
            - キーバリューストア（KVS）
                - キーとバリューのペアの形式だけ保存
            - ドキュメント思考データベース
                - 柔軟な構造のデータを保存可能

        - メリット
          - データの取得と格納が高度に最適化されている
          - RDBMSを超えるパフォーマンスを誇る
          - 大規模なデータや多種多様なデータに対応可能
        - デメリット
          - データの整合性を保てない
          - データの加工が難しい

        - 種類
          - HBase
          - MongoDB
          - Cassandra

#### データベース系の余談
- データベースの種類
  - 階層型データベース
    - 1つのノードから下に複数のノードが派生
    - ツリー状に展開
    - 1対多の関係
    - メリット
      - 検索の際にルートが限定的になり速度が早くなる
    - デメリット
      - 子ノードが複数の親ノードを持ちたい場合は重複登録が必要
      - 同じノードを複数入力するため、データ的に不自然に
      - 柔軟性にかける
        - データの追加、削除を行うとルートの再登録が必要
  - ネットワーク型データベース
    - 1つの子ノードが複数の親ノードを持つことができる
    - メリット
      - 階層型データベースの重複登録を避けることができる
    - デメリット
      - プログラムがデータ構造に依存してしまう問題がある
      - データの容易かつ柔軟な取り扱いに支障をきたす
  - リレーショナル型データベース
    - 列と行で構成されているデータベース
    - エクセルのようなイメージ
    - 現在は大体がデータベース＝RDB
    - 割愛

### Cookie

- サーバー側からクライアントにデータを保存させる仕組み
    - サーバー：「Set-Cookie:<キー>=<値>」というヘッダーを載せてレスポンス
        - クライアントはキーと値のペアを保存
    - クライアント：「Cookie:<キー>=<値>」を載せてリクエスト
        - Set-Cookieを返してきたドメインに対してのみリクエスト
    - HTTPが状態を維持

### Session

- 一連のアクセスでデータを保持する仕組み
    - Cookieだとセキュリティに懸念
        - パスワードを毎回やり取り、悪意のある書き換え（やり取りの回数＝リスクの発生回数）
    - データ量に限界がある

- セッション開始時（ログイン時）にランダムIDの発行
    - 発行されたIDをCookieに保存
    - IDをキーにしてデータをサーバーに保存

### 情報の保護

- 流出させてはいけない情報を守りたい
    - 例えばパスワードはハッシュ化を行う
    - DBには直接パスワードは保存せず、ハッシュ化したパスワードを保存
    - ログイン時は入力されたパスワードをハッシュ化し、DBの内容と比較
    - 一致すればログイン

- ハッシュ関数
    - 任意の長さのバイト列から固定長のバイト列を出力
    - 出力から入力の推測が難しい（非可逆、戻すことも不可能）
    - SHA-2、SHA-1、MD5などがある
    - より安全にしたい場合はsalt、HMACなどもある

- HTTP
    - 通信内容が丸見え

- HTTPS
    - HTTPをTLSで暗号化して通信を行う
    - 内容は見れない。改ざんされない。なりすまされない。
    - 現代では必須だか古いサイトは対応していなかったり


### WEBアプリケーションフレームワーク

- WEBアプリを作るのに便利機能の詰まったライブラリ
    - HTTPの処理
    - Cookie
    - データベースアクセス
    - テンプレートエンジン etc...
    - 現代でWEBアプリ開発を行う場合何かしらのフレームワークを使うことが多い
        - Rails、Spring、Djangoが有名
        - 独自フレームワークなども

### フロントエンド

- 種類
    - HTML
        - 文書に構造や意味を与える言語

    - テンプレートエンジン
        - HTMLの中にデータを埋め込んだりプログラム的に表示を変える仕組み
            - JSP、Freemarker、PHP、Smarty、eRuby etc...

        - 動的にHTMLを組み立てる為の仕組み

    - CSS
        - HTMLの見た目を定義する仕組み
        - 意味と見た目を分離する

    - Javascript
        - ブラウザで動作するプログラミング言語
        - DOM操作
            - 画面の書き換えなどが可能
        
        - Ajax/XHR
            - JavascriptからHTTP通信を行う。
            - 画面遷移無しで色々な動きが可能
        
        - フレームワーク
            - React
            - Vue
            - Closure
            - Library
            - etc...

### Web API

- WEBアプリケーションの処理をネットワーク越しに呼び出す
    - JSON、XML形式で結果を返却
    - サーバー内のデータを更新する
    - サーバーとクライアントを分離して管理がしやすくなる傾向がある