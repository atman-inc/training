# アプリケーション概要

学習者：m.sasaki

## まとめ

_Web開発の知識を広範囲に渡って紹介。この知識を使って自分で知識を広げていけるように_

## はじめに

- WEBアプリを作るのに必要な基礎知識の話
    - 雑多な知識
    - キーワードで自分で調べられる様になることが目的

### WEBアプリケーション

- WEBブラウザをインターフェースとして入出力するアプリケーション
    - 通信：HTTP
    - 表示：HTML、CSS
- アプリケーションはサーバーに設置
- ネイティブアプリやデスクトップアプリとは異なる。
    - ただし、内部でWEBアプリケーションが提供するAPIを利用しているものもある

### WEBサーバー

- HTTPを処理するサーバー
    - クライアントから問い合わせを受付（リクエスト）
    - 受付に対して結果を返す（レスポンス）

- WEBサーバソフト
    - Apache
    - IIS
    - nginX

#### Socket

- サーバーとクライアントで通信するためのAPI（ネットワークの接続口）
    - 主にTCP、UDPを使う
    - 同一マシン、別のマシンどちらとでも通信可能

- 処理の流れ
    - Socketの作成(socket)
    - アドレスを設定(bind)
    - リクエストを受付(listen)
    - リクエストを確立(accept)
    - 読み書きを行う（read/write）
    - 通信をクローズ（close）

- 同時に複数のリクエスト
    - プロセスやスレッドを使用

### プロセスとスレッド

#### プロセス

- プログラムの実行単位
    - コマンド、アプリの起動でプロセスが立ち上がる
    - 別のプロセスのメモリにはアクセス不可
    - 異なるプロセスは並列に動作可能

- WEBサーバー
    - リクエストを受付
    - 処理プロセスを起動してソケットを引き継ぐ

#### スレッド

- 1つのプロセスの中の処理単位
    - 並列処理が可能
    - 同じプロセスの別スレッドのメモリにアクセスできる

- WEBサーバー
    - リクエストを受付
    - 処理スレッドを起動して処理

### CGI(Common Gateway Interface)

- WEBサーバーとプログラムがやり取りするためのインターフェース
    - リクエストのたびにアプリのプロセスを起動
    - リクエストの内容は環境変数や標準入力で渡される
    - 結果は標準出力
    - 昔は主流だった

### WEBアプリケーションサーバー

- WEBアプリケーションを実行するサーバー
    - CGIとは異なり、通常は常時起動
    - WEBサーバーがアプリケーションサーバーにリクエスト
    - 主にHTTP通信

- アプリケーションサーバーとアプリ
    - サーバーからアプリの特定メソッドを呼び出してやり取り

### データベース

- WEBアプリケーションではデータの保存が必須になる
    - プログラム、マシンが終了後もデータを保持したい
    - ファイルに保存して管理をすると競合や不整合の回避が大変
    - DBMS(データベース管理システム)で管理を行う

- データベース管理システム（DBMS）
    - RDBMS / SQL
        - 「関係モデル」を扱うデータベース
        - SQL言語で操作
    
    - NoSQL
        - SQLに対抗して出現したデータベース
            - キーバリューストア（KVS）
                - キーとバリューのペアの形式だけ保存
            - ドキュメント思考データベース
                - 柔軟な構造のデータを保存可能

### Cookie

- サーバー側からクライアントにデータを保存させる仕組み
    - サーバー：「Set-Cookie:<キー>=<値>」というヘッダーを載せてレスポンス
        - クライアントはキーと値のペアを保存
    - クライアント：「Cookie:<キー>=<値>」を載せてリクエスト
        - Set-Cookieを返してきたドメインに対してのみリクエスト
    - HTTPが状態を維持

### Session

- 一連のアクセスでデータを保持する仕組み
    - Cookieだとセキュリティに懸念
        - パスワードを毎回やり取り、悪意のある書き換え（やり取りの回数＝リスクの発生回数）
    - データ量に限界がある

- セッション開始時（ログイン時）にランダムIDの発行
    - 発行されたIDをCookieに保存
    - IDをキーにしてデータをサーバーに保存

### 情報の保護

- 流出させてはいけない情報を守りたい
    - 例えばパスワードはハッシュ化を行う
    - DBには直接パスワードは保存せず、ハッシュ化したパスワードを保存
    - ログイン時は入力されたパスワードをハッシュ化し、DBの内容と比較
    - 一致すればログイン

- ハッシュ関数
    - 任意の長さのバイト列から固定長のバイト列を出力
    - 出力から入力の推測が難しい（非可逆、戻すことも不可能）
    - SHA-2、SHA-1、MD5などがある
    - より安全にしたい場合はsalt、HMACなどもある

- HTTP
    - 通信内容が丸見え

- HTTPS
    - HTTPをTLSで暗号化して通信を行う
    - 内容は見れない。改ざんされない。なりすまされない。
    - 現代では必須だか古いサイトは対応していなかったり


### WEBアプリケーションフレームワーク

- WEBアプリを作るのに便利機能の詰まったライブラリ
    - HTTPの処理
    - Cookie
    - データベースアクセス
    - テンプレートエンジン etc...
    - 現代でWEBアプリ開発を行う場合何かしらのフレームワークを使うことが多い
        - Rails、Spring、Djangoが有名
        - 独自フレームワークなども

### フロントエンド

- 種類
    - HTML
        - 文書に構造や意味を与える言語

    - テンプレートエンジン
        - HTMLの中にデータを埋め込んだりプログラム的に表示を変える仕組み
            - JSP、Freemarker、PHP、Smarty、eRuby etc...

        - 動的にHTMLを組み立てる為の仕組み

    - CSS
        - HTMLの見た目を定義する仕組み
        - 意味と見た目を分離する

    - Javascript
        - ブラウザで動作するプログラミング言語
        - DOM操作
            - 画面の書き換えなどが可能
        
        - Ajax/XHR
            - JavascriptからHTTP通信を行う。
            - 画面遷移無しで色々な動きが可能
        
        - フレームワーク
            - React
            - Vue
            - Closure
            - Library
            - etc...

### Web API

- WEBアプリケーションの処理をネットワーク越しに呼び出す
    - JSON、XML形式で結果を返却
    - サーバー内のデータを更新する
    - サーバーとクライアントを分離して管理がしやすくなる傾向がある