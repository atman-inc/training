# 6章 アーキテクチャを選ぶ（君がアーキテクチャに選ばれる前に）

担当: @koushisa

## まとめ

_ASR(重要な要求)に基づいたアーキテクチャのトレードオフを選択する方法を学ぶ_  

### アーキテクチャ上重要なものを探求する

_選択肢を発散させ、合意形成によって収束させる_

- 問題を特定したら、解決策を複数作り上げる
  - まずは選択肢を作ること
  - その上で品質特定、構造的な、影響度合いを考慮して絞り込む
- ソフトウェアのアーキテクトが設計時に探求する分野
  - アーキテクチャ構造の全体構成を決定するために、要素とその役割を探求する
    - システムは要素の集まりであり、要素ごとに明確な責務を割り当てる
  - 要素がどう相互作用するかを決定するために、関係とのインターフェイスを探求する
    - タスクを達成するために要素がどう連携するかを表す
    - メソッド名やフィールドなどの詳細は後続の設計に委ねることが出来る
  - アーキテクチャが形取る世界を理解するためにドメインを探求する
    - ドメインに基づく用語と概念を整理し、問題領域をよく理解する
    - ドメイン要素を分割して責務を割り当てる
      - ex. 売上を管理する機能だと
        - 契約金
        - 支払い方法
        - 売掛金
        - 現時点の支払額
  - 品質特性を促進していけるような技術やフレームワークを探求する
    - ミドルウェア、ライブラリ
    - 採用した技術毎に哲学・制約が有り、メリット・デメリットのトレードオフが許容できるか
  - 出荷を確実にするような構築方法やデプロイ方法を探求する
    - CI, CD
    - 並行作業
    - テスト環境
  - 意思決定を導く視点を得るため、過去の設計を探求する
    - 全ての設計は再設計である
    - 既存のシステムやオープンソースなどで似たような問題解決を行うアーキテクチャを探索する

### 制約を受け入れる

_制約とは過去に下した変更できない設計判断_

- 制約には2種類存在する
  1. 技術的な制約
    - 技術の選択肢
      - 受け入れてアーキテクチャに組み込む以外の選択肢は無い
  2. ビジネス上の制約
    - 人
    - プロセス
    - コスト
    - スケジュール
  - ビジネス上の制約は、アーキテクチャの外側で満たすことも出来る
    - 職人技による量産
    - 早い段階でのテストを重視する
    - 低コストの下請け業者を利用する
  - ステークホルダは制約がアーキテクチャにどのように影響を与えるかを常に理解しているわけではない
    - 制約をすぐに受け入れるようなことはせず、影響度を必ず調査する
    - コストの高い制約はステークホルダと相談するべき

### 品質特性を考慮してパターンを探求する

_全ての設計は再設計だということを肝に命じる_

- 望ましい品質特性を促進する既存のパターンを見つけ、アーキテクチャの出発点として使う
- Webベースのデータ駆動アプリケーションの例
  - 3層パターン
    -  表示層
    - ビジネス層
    - データベース
  - パブリッシュ・サブスクライブパターン
    - 要素はメッセージをイベントバスに発行(パブリッシュ)
    - コンポーネントはメッセージを購読（サブスクライブ）
  - サービス指向アーキテクチャパターン
    - 呼び出し側がサービスを見つけられるように、サービスは中央のレジストリに登録される
    - コンポーネントがそれらのサービスを直接検索して呼び出す
- 正しい設計や誤った設計というのはめったに無く、あるのは良い設計か悪い設計

### 意思決定マトリクスを作成する

- アーキテクチャの選択肢を意思決定マトリクスの表に含めることで、最善の決定を明らかにする
  - 強く推進する
    - システム特性の実現を積極的に助ける
  - 促進する
    - システム特性の実現を可能にする
  - 中立
    - システム特性を向上させることを損なうこともない
  - 阻害する
    - システム特性の実現を多少困難にする
  - 強く阻害する
    - システム特性の実現を高コストにする
- 表を要約し、ステークホルダとの議論を促進するのに役立てる事ができる
  - 数値はあまり使わないほうがいい
  - 分析において誤った信頼感や精度を与える場合が多い

### 機能的責務を要素に割り当てる

- システムの機能要求には、いくつかの責務が暗示されている
  - 機能要求には文章もあれば、図もある
  - 機能要求を構築する各要素に特定の機能的責務を割り当て、最小単位に分割していく
- 要素責務カタログ(図参照)
  - アーキテクチャ内の各要素が行う本質的な責務を説明する図
  - 機能要求ごとに、各機能が1つの要素によって所有されるようにする
- 要素ごとの責務を明らかにすることで疎結合なアーキテクチャを構築していく

### 変化に向けて設計する

- 責任を持てる限り拘束力のある判断を可能な限り遅らせる
  - 探求の時間を生み出すことに繋がる
  - 設計判断を下すのに適した時期を見極めるのに役立つ質問
    - 判断しないことが進捗を妨げるか？
    - 判断は後回しにできない問題を解決するか？
    - 判断はより多くの選択肢や新しい機会を生み出すか？
    - 判断を遅らせることで、はるかに大きなリスクが存在するか？
    - 判断の意味を理解し受け入れるか？
    - 今この判断を下す理由について明確な根拠があるか？
- 可能な限り変更の可能性がある部分については、後続の設計者が判断を下せるように設計する

## 分かってないこと

- 特にないです

## ディスカッション

- いいのが思いつきませんでした。。
