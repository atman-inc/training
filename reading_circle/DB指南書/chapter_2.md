# 論理設計と物理設計

学習者：m.sasaki

## 1.概念スキーマと論理設計
- 概念スキーマを定義する設計を「**論理設計**」と呼ぶ
  - 論理　＝　「**物理層の制約にとらわれない**」という意味
  - サーバーのCPUやストレージなどにとらわれない

<br>

- データベース設計の手順
  - 概念スキーマ（論理設計）　→　内部スキーマ（物理設計）

---

### 論理設計のステップ
- 手順
  1. エンティティの抽出
     - エンティティ＝データ
     - 必要なデータの抽出は要件定義と重なる 
  2. エンティティの定義
     - エンティティはデータを属性（テーブルの列と同義）で保持
     - 各テーブルにどのような列を持つかを定義する作業
     - 特に重要なのは「キー」という列 
  3. 正規化
     - エンティティ（テーブル）の整理を行う
     - 正規化を行って初めてシステムでの利用に耐えうる形になる
     - エンティティの細分化 
  4. ER図(Entity-Relationship Diagram)の作成
     -  エンティティ同士の繋がり（関係性）を表現する図を作成する

---

## 2.内部スキーマと物理設計

### 物理設計のステップ
- 手順
  1. テーブル定義
     - 概念スキーマをDBMS内部に格納するための「テーブル」単位に変換していく作業 
  2. インデックス定義
     - インデックスの重要な役割はパフォーマンス 
  3. ハードウェアのサイジング
     - 記憶容量（ストレージ）の選定
       - 選定は物理的なテーブル定義とインデックス定義を行わないと算出できない
       - データ量の中にはテキスト、画像、HTMLなどの様々な形式のファイルを加算して考慮
       - サービス終了時のデータ量を考慮する
         - サービス運用中にデータが足りないとならない為に
     - パフォーマンスの為にサーバーのCPUやメモリの選定 
  4. ストレージの冗長構成決定
     - ストレージ＝データを保持する媒体（例えばHDD）
     - データベースサーバー等で行われているもの
     - 複数のハードディスクを用意して、複数に同じデータを保持
     - 1つがダウンしても他のハードディスクで保全できるという考え方 
  5. ファイルの物理配置決定
     - データベースに格納されるファイルの種類（5種）
       1. データファイル
          - データベースに格納するデータを保持するためのファイル
          - SQLからデータの参照や更新を行うファイル 
       2. インデックスファイル
          - テーブルに作成されたインデックスを格納するファイル 
       3. システムファイル
          - DBMSの内部管理にす要するファイル 
       4. 一時ファイル
          - 一時的なデータを格納するファイル 
       5. ログファイル
          - 変更分をためておくファイル

---

#### データの整合性とパフォーマンスはトレードオフの関係
- 限られた予算の中で納得のいく割合を見つけ出す努力がデータベース設計

#### サービス終了時にも安全な容量を考慮するのは難しい
- その為にできること
  1. 安全率を大きくとって余裕を持たせたサイジングを行う
  2. もし容量が不足した場合に容易に増設できる仕組みを採る（スケーラビリティの高い仕組）

**<font color="red">※スケーラビリティ・・・拡張性</font>**

#### パフォーマンス（性能要件）のサイジング
- 処理時間
- スループット（こなせる処理の多さ）

##### 新規システムを開発する際にこれを見積もりのは難しい
- 方法2種
  1. 既存システムで似ているものから推測を行う
  2. プロトタイプを作成して検証する

---
## 3.バックアップ設計
- バックアップ設計
  - 完全バックアップ
    - すべてのデータのバックアップを取る
    - 時間がかかる
    - サービス停止の必要がある

<br>

  - 差分バックアップ
    - フルバックアップからの変更分だけをログファイルからバックアップ
    - フルバックアップと最新の差分ファイルが必要
    - ファイルが増えることで手順が増える

<br>

  - 増分バックアップ
    - フルバックアップからその日の変更分を毎日バックアップ
    - フルバックアップとすべての日の変更分ファイルが必要
    - 差分バックアップよりも手順が複雑になる

---

- リカバリ設計
  - リカバリ
    - バックアップファイルを戻す作業

<br>

  - リストア
    - トランザクションログを適用して変更分を反映する作業

<br>

  - ロールフォワード
    - データベースサーバーに残っているトランザクションログを適用する作業
