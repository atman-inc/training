# HTTP/1.1のシンタックス: 高速化と安全性を求めた拡張

本章で取り上げるHTTP/1.1のプロトコルシンタックスの変更点
- 通信の高速化
  - Keep-Aliveがデフォルトで有効に
- TLSによる暗号化通信のサポート
- 新メソッドの追加
  - PUTとDELETEが必須メソッドに
  - OPTION, TRACE, CONNECTメソッド追加
- プロトコルのアップグレード
- 名前を使ったバーチャルホストのサポート
- サイズが事前にわからないコンテンツのチャンク転送エンコーディングのサポート
- DATA URIスキーム

## 4.1 Keep-Aliveによる通信の高速化

引用元: https://atmarkit.itmedia.co.jp/ait/articles/1605/11/news030_3.html
> HTTPの基本的な動作では、「リクエストのたびに接続を確立し、1つのレスポンスを返したら接続を切る」ということを繰り返します。
実際のWebページを見ると、そこには文字以外に複数の要素（写真、画像、音楽など）が含まれており、1つの画面を表示するにはこれら全てをサーバから取得する必要があります。そのため、Webページを見るときには通常、HTTPのリクエストを何度か繰り返して、必要な全ての情報をサーバから取得します。
しかしながら、HTTPのリクエストとレスポンスを1つやりとりするたびに、いちいち接続を準備して切断することを繰り返すのは、明らかな無駄です。
そこで、現在最も多く使われているバージョンのHTTP（HTTP 1.1）では、この無駄を省く仕組みが用意されています。具体的には、特に指定がない限り、レスポンスを返した後に接続を維持し、次のリクエストを送るときは、保持している接続をそのまま再利用してリクエストを送ることができるようになっています。接続を切らずに保持しておくこの動作は、「Keep-Alive」と呼ばれます。
https://image.itmedia.co.jp/ait/articles/1605/11/l_tcpip7.jpg

- Keep-Aliveは、HTTPの下のレイヤーであるTCP/IPの通信を効率化する仕組み
  - https://www.itmanage.co.jp/column/tcp-ip-protocol/
- 接続を継続して通信を行うことで、TCP/IPは再接続までの待ち時間が減る
- 通信開始から終わりまでのことをRTT(ラウンドトリップタイム)と呼ぶ
  - TLSではハンドシェイクと呼ばれる通信開始前の情報交換に2RTTぶん時間がかかる
    - https://www.idcf.jp/rentalserver/aossl/basic/ssl-tls/
- Keep-Aliveはクライアントとサーバーの両方が、持続時間を持っており、その短い方で通信の切断が行われる

### 4.1.1 パイプランニング

- 最初のリクエストが完了する前に次のリクエストを送信し、レスポンスを待って次のリクエストを出すまでの待ち時間を排除
- ただクライアントとサーバーの環境によってうまく動作がしなかったり、パフォーマンスがあまり上がらなかった事象も
- リクエストの順序通りレスポンスを返さなければならないということは、レスポンス生成に時間がかかる処理があると、他のレスポンスを阻害してしまう。
  - Head-of-Line Blocking(HOLブロッキング, HOL)と呼ばれている問題

## 4.2 TLS(トランスポート・レイヤー・セキュリティ)
